# 개발 사이클: PLAN → CHECK → BUILD → VERIFY → CLEAN → COMMIT

> 미러: `.agents/workflows/development-cycle.yaml`

## 문제 인식

AI와 개발하면 발생하는 전형적 문제:
1. 같은 기능을 다른 파일에 또 만듦 **(중복)**
2. 이전 구현을 정리 안 하고 새 걸 만듦 **(좀비 코드)**
3. 임시 코드가 영구 코드가 됨 **(기술 부채)**
4. 어떤 파일이 쓰이는지 모름 **(미추적 코드)**

## 6단계 사이클

### 1. PLAN — 기존 코드 먼저 확인

```
"무엇을 만들지, 어디에 만들지, 기존에 있는지" 확인
```

- 요구사항을 한 문장으로 정리
- **기존 코드에 동일/유사 기능이 있는지 검색**
- 있으면 → 기존 코드 수정 (새로 만들지 않음)
- 없으면 → 어느 모듈에 넣을지 결정
- 영향받는 파일 목록 작성

**금지:**
- 기존 코드 확인 없이 새 파일 생성
- "나중에 정리하자" 임시 코드
- 유사 유틸을 다른 위치에 또 만들기

### 2. CHECK — 충돌/중복 사전 확인

- 변경할 파일 읽고 현재 상태 파악
- import/export 의존 그래프 확인
- 동일 이름의 함수/클래스가 다른 곳에 있는지 검색
- 테스트 파일 존재 여부 확인

**금지:**
- 읽지 않은 파일 수정
- 사용처 확인 없이 export 제거

### 3. BUILD — TDD로 최소 구현

- RED: 테스트 먼저 작성
- GREEN: 최소 코드로 통과
- REFACTOR: 정리

**규칙:**
- 한 번에 한 기능만
- 새 파일 최소한으로
- 유틸/헬퍼는 한 곳에만
- 임시 코드에는 `// TODO:` 필수

### 4. VERIFY — 구현 검증 + 보안 리뷰

- `pnpm test` 전체 통과
- `pnpm lint && pnpm typecheck` 통과
- `git diff --stat`으로 변경 파일 확인
- 의도하지 않은 변경 없는지 확인
- 새 파일이 정말 필요한지 재확인

**보안 리뷰:**
- 새 도구/명령의 권한 Tier가 올바른지 확인
- 감사 로그에 새 행동이 기록되는지 확인
- 인증 정보가 코드/로그에 노출되지 않는지 확인
- 위험 작업이 Podman 샌드박스를 사용하는지 확인
- LLM 프롬프트 변경이 있다면 안전성 검토

### 5. CLEAN — 잔재 제거

- 이전 구현 삭제
- 미사용 import 제거
- 미사용 함수/변수/파일 삭제
- 해결된 TODO 제거
- console.log 제거
- `pnpm knip` 실행 (미사용 export 검출)

**금지:**
- 이전 코드를 주석처리만 하고 남겨둠
- "나중에 쓸 수 있으니까" 미사용 코드 유지
- `_oldFunction`, `_backup` 같은 보존

### 6. COMMIT — 깔끔한 커밋

- `git status`로 최종 확인
- 관련 파일만 staging
- 하나의 커밋 = 하나의 변경
- WIP 커밋 금지

---

## 리뷰 관문 (4단계)

### Gate 1: 셀프 리뷰 (커밋 전)

- [ ] 범위를 벗어나지 않았는가?
- [ ] 새 파일이 정말 필요했는가?
- [ ] 중복 코드 없는가?
- [ ] 미사용 코드 안 남았는가?
- [ ] 테스트 추가했는가?
- [ ] console.log 없는가?

### Gate 2: 자동 검증 (CI)

- Biome lint
- TypeScript typecheck
- 전체 테스트
- knip (미사용 export)
- gitleaks (인증정보 누출)
- cargo audit (Rust 취약점)

### Gate 3: 사람 리뷰 (PR 머지 전)

- 올바른 모듈에 코드가 있는가?
- 보안 (Tier, 감사 로그)
- 성능 (불필요한 LLM 호출, 무한 루프)
- 유지보수 (6개월 후 이해 가능?)

### Gate 4: 머지 후 검증

- BlueBuild 이미지 빌드
- OS smoke test (VM)
- ISO 생성

---

## AI 페어 코딩 추가 규칙

### 코딩 전
- 기존 코드를 **먼저 읽어라**
- 동일 기능이 **이미 있는지 검색**해라
- 작업 범위를 **명확히** 해라

### 코딩 중
- 새 파일 생성 **최소화**
- 유틸 함수는 **반드시 검색 후** 추가
- 한 번에 **너무 많이 바꾸지 말 것**

### 코딩 후
- 변경 파일 목록 **검토**
- 이전 구현 잔재 **제거**
- 미사용 코드 **제거** (knip)

### 세션 종료 시
- 완료된 작업 **커밋**
- 미완료 = TODO + 작업 로그
- 다음 세션 컨텍스트 **명시**
- 반쯤 만든 코드 **커밋 금지**
